{"ast":null,"code":"var _jsxFileName = \"L:\\\\Work\\\\Projects\\\\guest-book-client-main\\\\guest-book-client-main\\\\src\\\\components\\\\Message\\\\Message.js\",\n    _s = $RefreshSig$();\n\nimport { useRef, useState } from 'react';\nimport guestBookApi from '../../api/guest-book';\nimport { useAuthContext } from '../../context/auth/AuthProvider';\nimport { useMessagesContext } from '../../context/auth/MessagesProvider';\nimport { protectedTrimString } from '../../helpers/validation';\nimport styles from './Message.module.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst Message = _ref => {\n  _s();\n\n  let {\n    messageInfo\n  } = _ref;\n  const {\n    username,\n    content,\n    creationDate,\n    id,\n    replies\n  } = messageInfo;\n  const [editingMessage, setEditingMessage] = useState(false);\n  const [replyingMessage, setReplyingMessage] = useState(false);\n  const [showReplies, setShowReplies] = useState(false);\n  const {\n    dispatch\n  } = useMessagesContext();\n  const {\n    state: userInfo\n  } = useAuthContext();\n  const messageRef = useRef();\n  const replyRef = useRef();\n\n  const formatDate = date => new Date(date).toDateString() + '  ' + new Date(date).toLocaleTimeString();\n\n  const dateFormated = formatDate(creationDate);\n\n  const fetchMessages = async () => {\n    try {\n      const {\n        messages,\n        errors\n      } = await guestBookApi.fetchMessages();\n\n      if (!errors) {\n        dispatch({\n          type: 'SET_MESSAGES',\n          payload: messages\n        });\n      }\n    } catch (error) {\n      console.log('error -------------- ', error);\n    }\n  };\n\n  const deleteMessage = async (messageId, username) => {\n    try {\n      const {\n        deletedMessageId,\n        errors\n      } = await guestBookApi.deleteMessage(messageId, username);\n      console.log(deletedMessageId, errors);\n    } catch (error) {\n      console.log('error -------------- ', error);\n    }\n  };\n\n  const updateMessage = async (messageId, username, content, reply) => {\n    try {\n      const {\n        updatedMessageId,\n        errors\n      } = await guestBookApi.updateMessage(messageId, username, content, reply);\n      return {\n        updatedMessageId,\n        errors\n      };\n    } catch (error) {\n      console.log('error -------------- ', error);\n    }\n  };\n\n  const removeMessageHandler = async () => {\n    await deleteMessage(id, username);\n    await fetchMessages();\n  };\n\n  const handleEditMessage = async e => {\n    e.preventDefault();\n    const editMessage = messageRef.current.value;\n\n    if (!protectedTrimString(editMessage)) {\n      return;\n    }\n\n    const {\n      errors\n    } = await updateMessage(id, username, editMessage);\n\n    if (!errors) {\n      await fetchMessages();\n      setEditingMessage(false);\n    }\n  };\n\n  const handleReplyMessage = async e => {\n    e.preventDefault();\n    const replyMessage = replyRef.current.value;\n    const reply = {\n      username: userInfo.userData.username,\n      content: replyMessage\n    };\n\n    if (!protectedTrimString(replyMessage)) {\n      return;\n    }\n\n    const {\n      updatedMessageId,\n      errors\n    } = await updateMessage(id, username, content, reply);\n\n    if (!errors) {\n      await fetchMessages();\n      setReplyingMessage(false);\n    }\n\n    console.log(updatedMessageId);\n  };\n\n  const renderCancelEditBtn = () => {\n    return /*#__PURE__*/_jsxDEV(\"button\", {\n      className: styles.btn,\n      onClick: () => setEditingMessage(false),\n      children: \"Cancel\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 7\n    }, this);\n  };\n\n  const renderCancelReplyBtn = () => {\n    return /*#__PURE__*/_jsxDEV(\"button\", {\n      className: styles.btn,\n      onClick: () => setReplyingMessage(false),\n      children: \"Cancel\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 7\n    }, this);\n  };\n\n  const renderReplies = () => {\n    if (!showReplies) {\n      return null;\n    }\n\n    if (replies && replies.length > 0) {\n      return replies.map(_ref2 => {\n        let {\n          id,\n          username,\n          content,\n          creationDate\n        } = _ref2;\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: styles.reply,\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: styles.replyHeader,\n            children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n              className: styles.replyTitle,\n              children: username\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 142,\n              columnNumber: 13\n            }, this), /*#__PURE__*/_jsxDEV(\"h5\", {\n              className: styles.replySubTitle,\n              children: formatDate(creationDate)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 143,\n              columnNumber: 13\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 141,\n            columnNumber: 11\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: /*#__PURE__*/_jsxDEV(\"p\", {\n              className: styles.replyContent,\n              children: content\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 146,\n              columnNumber: 13\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 145,\n            columnNumber: 11\n          }, this)]\n        }, id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 140,\n          columnNumber: 9\n        }, this);\n      });\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: styles.Message,\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: styles.header,\n      children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n        className: styles.title,\n        children: username\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h5\", {\n        className: styles.date,\n        children: dateFormated\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: styles.body,\n      children: /*#__PURE__*/_jsxDEV(\"p\", {\n        className: styles.content,\n        children: content\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: styles.footer,\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: styles.btn,\n        onClick: () => setReplyingMessage(prevState => !prevState),\n        children: \"reply\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 163,\n        columnNumber: 9\n      }, this), userInfo.userData.username === username && /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: styles.btn,\n          onClick: () => setEditingMessage(prevState => !prevState),\n          children: \"edit\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 172,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: styles.btn,\n          onClick: removeMessageHandler,\n          children: \"delete\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 178,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [editingMessage && /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"form\", {\n          className: styles.form,\n          onSubmit: handleEditMessage,\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: styles.formGroup,\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              htmlFor: \"text\",\n              children: \"Message\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 189,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"edit_text\",\n              placeholder: \"Edit Message\",\n              id: \"edit_text\",\n              className: styles.formInput,\n              ref: messageRef,\n              defaultValue: content\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 190,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 188,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: styles.btnWrapper,\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              className: styles.btn,\n              children: \"Edit Message\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 200,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 199,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 187,\n          columnNumber: 13\n        }, this), renderCancelEditBtn()]\n      }, void 0, true), replyingMessage && /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"form\", {\n          className: styles.form,\n          onSubmit: handleReplyMessage,\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: styles.formGroup,\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              htmlFor: \"text\",\n              children: \"Reply\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 210,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"reply_text\",\n              placeholder: \"Reply\",\n              id: \"reply_text\",\n              className: styles.formInput,\n              ref: replyRef\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 211,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 209,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: styles.btnWrapper,\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              className: styles.btn,\n              children: \"Reply\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 220,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 219,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 208,\n          columnNumber: 13\n        }, this), renderCancelReplyBtn()]\n      }, void 0, true)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: styles.repliesContainer,\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: styles.btn,\n        onClick: () => setShowReplies(prevState => !prevState),\n        children: \"View replies\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 228,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: styles.replies,\n        children: renderReplies()\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 227,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 154,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Message, \"UNJ1PEgk+yPqdxkiWb8KiUJgUMQ=\", false, function () {\n  return [useMessagesContext, useAuthContext];\n});\n\n_c = Message;\nexport default Message;\n\nvar _c;\n\n$RefreshReg$(_c, \"Message\");","map":{"version":3,"sources":["L:/Work/Projects/guest-book-client-main/guest-book-client-main/src/components/Message/Message.js"],"names":["useRef","useState","guestBookApi","useAuthContext","useMessagesContext","protectedTrimString","styles","Message","messageInfo","username","content","creationDate","id","replies","editingMessage","setEditingMessage","replyingMessage","setReplyingMessage","showReplies","setShowReplies","dispatch","state","userInfo","messageRef","replyRef","formatDate","date","Date","toDateString","toLocaleTimeString","dateFormated","fetchMessages","messages","errors","type","payload","error","console","log","deleteMessage","messageId","deletedMessageId","updateMessage","reply","updatedMessageId","removeMessageHandler","handleEditMessage","e","preventDefault","editMessage","current","value","handleReplyMessage","replyMessage","userData","renderCancelEditBtn","btn","renderCancelReplyBtn","renderReplies","length","map","replyHeader","replyTitle","replySubTitle","replyContent","header","title","body","footer","prevState","form","formGroup","formInput","btnWrapper","repliesContainer"],"mappings":"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","sourcesContent":["import { useRef, useState } from 'react';\nimport guestBookApi from '../../api/guest-book';\nimport { useAuthContext } from '../../context/auth/AuthProvider';\nimport { useMessagesContext } from '../../context/auth/MessagesProvider';\nimport { protectedTrimString } from '../../helpers/validation';\nimport styles from './Message.module.css';\n\nconst Message = ({ messageInfo }) => {\n  const { username, content, creationDate, id, replies } = messageInfo;\n\n  const [editingMessage, setEditingMessage] = useState(false);\n\n  const [replyingMessage, setReplyingMessage] = useState(false);\n\n  const [showReplies, setShowReplies] = useState(false);\n\n  const { dispatch } = useMessagesContext();\n\n  const { state: userInfo } = useAuthContext();\n\n  const messageRef = useRef();\n  const replyRef = useRef();\n\n  const formatDate = (date) =>\n    new Date(date).toDateString() + '  ' + new Date(date).toLocaleTimeString();\n\n  const dateFormated = formatDate(creationDate);\n\n  const fetchMessages = async () => {\n    try {\n      const { messages, errors } = await guestBookApi.fetchMessages();\n\n      if (!errors) {\n        dispatch({ type: 'SET_MESSAGES', payload: messages });\n      }\n    } catch (error) {\n      console.log('error -------------- ', error);\n    }\n  };\n\n  const deleteMessage = async (messageId, username) => {\n    try {\n      const { deletedMessageId, errors } = await guestBookApi.deleteMessage(\n        messageId,\n        username,\n      );\n\n      console.log(deletedMessageId, errors);\n    } catch (error) {\n      console.log('error -------------- ', error);\n    }\n  };\n\n  const updateMessage = async (messageId, username, content, reply) => {\n    try {\n      const { updatedMessageId, errors } = await guestBookApi.updateMessage(\n        messageId,\n        username,\n        content,\n        reply,\n      );\n\n      return { updatedMessageId, errors };\n    } catch (error) {\n      console.log('error -------------- ', error);\n    }\n  };\n\n  const removeMessageHandler = async () => {\n    await deleteMessage(id, username);\n    await fetchMessages();\n  };\n\n  const handleEditMessage = async (e) => {\n    e.preventDefault();\n\n    const editMessage = messageRef.current.value;\n\n    if (!protectedTrimString(editMessage)) {\n      return;\n    }\n\n    const { errors } = await updateMessage(id, username, editMessage);\n\n    if (!errors) {\n      await fetchMessages();\n      setEditingMessage(false);\n    }\n  };\n\n  const handleReplyMessage = async (e) => {\n    e.preventDefault();\n\n    const replyMessage = replyRef.current.value;\n    const reply = {\n      username: userInfo.userData.username,\n      content: replyMessage,\n    };\n    if (!protectedTrimString(replyMessage)) {\n      return;\n    }\n\n    const { updatedMessageId, errors } = await updateMessage(\n      id,\n      username,\n      content,\n      reply,\n    );\n\n    if (!errors) {\n      await fetchMessages();\n      setReplyingMessage(false);\n    }\n\n    console.log(updatedMessageId);\n  };\n\n  const renderCancelEditBtn = () => {\n    return (\n      <button className={styles.btn} onClick={() => setEditingMessage(false)}>\n        Cancel\n      </button>\n    );\n  };\n\n  const renderCancelReplyBtn = () => {\n    return (\n      <button className={styles.btn} onClick={() => setReplyingMessage(false)}>\n        Cancel\n      </button>\n    );\n  };\n\n  const renderReplies = () => {\n    if (!showReplies) {\n      return null;\n    }\n    if (replies && replies.length > 0) {\n      return replies.map(({ id, username, content, creationDate }) => (\n        <div key={id} className={styles.reply}>\n          <div className={styles.replyHeader}>\n            <h4 className={styles.replyTitle}>{username}</h4>\n            <h5 className={styles.replySubTitle}>{formatDate(creationDate)}</h5>\n          </div>\n          <div>\n            <p className={styles.replyContent}>{content}</p>\n          </div>\n        </div>\n      ));\n    }\n  };\n\n  return (\n    <div className={styles.Message}>\n      <div className={styles.header}>\n        <h4 className={styles.title}>{username}</h4>\n        <h5 className={styles.date}>{dateFormated}</h5>\n      </div>\n      <div className={styles.body}>\n        <p className={styles.content}>{content}</p>\n      </div>\n      <div className={styles.footer}>\n        <button\n          className={styles.btn}\n          onClick={() => setReplyingMessage((prevState) => !prevState)}\n        >\n          reply\n        </button>\n\n        {userInfo.userData.username === username && (\n          <>\n            <button\n              className={styles.btn}\n              onClick={() => setEditingMessage((prevState) => !prevState)}\n            >\n              edit\n            </button>\n            <button className={styles.btn} onClick={removeMessageHandler}>\n              delete\n            </button>\n          </>\n        )}\n      </div>\n      <div>\n        {editingMessage && (\n          <>\n            <form className={styles.form} onSubmit={handleEditMessage}>\n              <div className={styles.formGroup}>\n                <label htmlFor='text'>Message</label>\n                <input\n                  type='edit_text'\n                  placeholder='Edit Message'\n                  id='edit_text'\n                  className={styles.formInput}\n                  ref={messageRef}\n                  defaultValue={content}\n                />\n              </div>\n              <div className={styles.btnWrapper}>\n                <button className={styles.btn}>Edit Message</button>\n              </div>\n            </form>\n            {renderCancelEditBtn()}\n          </>\n        )}\n        {replyingMessage && (\n          <>\n            <form className={styles.form} onSubmit={handleReplyMessage}>\n              <div className={styles.formGroup}>\n                <label htmlFor='text'>Reply</label>\n                <input\n                  type='reply_text'\n                  placeholder='Reply'\n                  id='reply_text'\n                  className={styles.formInput}\n                  ref={replyRef}\n                />\n              </div>\n              <div className={styles.btnWrapper}>\n                <button className={styles.btn}>Reply</button>\n              </div>\n            </form>\n            {renderCancelReplyBtn()}\n          </>\n        )}\n      </div>\n      <div className={styles.repliesContainer}>\n        <button\n          className={styles.btn}\n          onClick={() => setShowReplies((prevState) => !prevState)}\n        >\n          View replies\n        </button>\n        <div className={styles.replies}>{renderReplies()}</div>\n      </div>\n    </div>\n  );\n};\n\nexport default Message;\n"]},"metadata":{},"sourceType":"module"}